---
import Landing from "@/views/Landing.astro";
import Layout from "@/layouts/Layout.astro";

import "@/styles/globals.css";
import { getSession } from "auth-astro/server";
import { getUser } from "@/db/queries/get-user";

export const prerender = false;

const session = await getSession(Astro.request);
const user = session?.user;

if (user && user.email) {
  const userData = await getUser(user.email);
  if (userData && !userData.invitation) {
    return Astro.redirect("/invite-only");
  }
}
---

<Layout>
  <Landing />
</Layout>
